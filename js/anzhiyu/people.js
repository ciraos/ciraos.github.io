function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){var a;if(e)return"string"==typeof e?_arrayLikeToArray(e,r):"Map"===(a="Object"===(a=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,r):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var a=0,t=new Array(r);a<r;a++)t[a]=e[a];return t}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,r,a){return r&&_defineProperties(e.prototype,r),a&&_defineProperties(e,a),e}var peopleConfig={src:GLOBAL_CONFIG.peoplecanvas.img,rows:15,cols:7},randomRange=function(e,r){return e+Math.random()*(r-e)},randomIndex=function(e){return 0|randomRange(0,e.length)},removeFromArray=function(e,r){return e.splice(r,1)[0]},removeItemFromArray=function(e,r){return removeFromArray(e,e.indexOf(r))},removeRandomFromArray=function(e){return removeFromArray(e,randomIndex(e))},getRandomFromArray=function(e){return e[0|randomIndex(e)]},resetPeep=function(e){var r,a,t=e.stage,e=e.peep,n=.5<Math.random()?1:-1,o=100-250*gsap.parseEase("power2.in")(Math.random()),o=t.height-e.height+o;return 1==n?(r=-e.width,a=t.width,e.scaleX=1):(r=t.width+e.width,a=0,e.scaleX=-1),e.x=r,e.y=o,{startX:r,startY:e.anchorY=o,endX:a}},normalWalk=function(e){var r=e.peep,e=e.props,a=(e.startX,e.startY),e=e.endX,t=gsap.timeline();return t.timeScale(randomRange(.5,1.5)),t.to(r,{duration:10,x:e,ease:"none"},0),t.to(r,{duration:.25,repeat:40,yoyo:!0,y:a-10},0),t},walks=[normalWalk],Peep=(()=>{function a(e){var r=e.image,e=e.rect;_classCallCheck(this,a),this.image=r,this.setRect(e),this.x=0,this.y=0,this.anchorY=0,this.scaleX=1,this.walk=null}return _createClass(a,[{key:"setRect",value:function(e){this.rect=e,this.width=e[2],this.height=e[3],this.drawArgs=[this.image].concat(_toConsumableArray(e),[0,0,this.width,this.height])}},{key:"render",value:function(e){e.save(),e.translate(this.x,this.y),e.scale(this.scaleX,1),e.drawImage.apply(e,_toConsumableArray(this.drawArgs)),e.restore()}}]),a})(),img=document.createElement("img"),peoplecanvasEl=(img.onload=init,img.src=peopleConfig.src,document.getElementById("peoplecanvas")),ctx=peoplecanvasEl?peoplecanvasEl.getContext("2d"):void 0,stage={width:0,height:0},allPeeps=[],availablePeeps=[],crowd=[];function init(){peoplecanvasEl&&(createPeeps(),resize(),gsap.ticker.add(render),window.addEventListener("resize",resize))}function createPeeps(){for(var e=peopleConfig.rows,r=peopleConfig.cols,a=e*r,t=img.naturalWidth/e,n=img.naturalHeight/r,o=0;o<a;o++)allPeeps.push(new Peep({image:img,rect:[o%e*t,(o/e|0)*n,t,n]}))}function resize(){peoplecanvasEl&&0!=peoplecanvasEl.clientWidth&&(stage.width=peoplecanvasEl.clientWidth,stage.height=peoplecanvasEl.clientHeight,peoplecanvasEl.width=stage.width*devicePixelRatio,peoplecanvasEl.height=stage.height*devicePixelRatio,crowd.forEach(function(e){e.walk.kill()}),crowd.length=0,availablePeeps.length=0,availablePeeps.push.apply(availablePeeps,allPeeps),initCrowd())}function initCrowd(){for(;availablePeeps.length;)addPeepToCrowd().walk.progress(Math.random())}function addPeepToCrowd(){var e=removeRandomFromArray(availablePeeps),r=getRandomFromArray(walks)({peep:e,props:resetPeep({peep:e,stage:stage})}).eventCallback("onComplete",function(){removePeepFromCrowd(e),addPeepToCrowd()});return e.walk=r,crowd.push(e),crowd.sort(function(e,r){return e.anchorY-r.anchorY}),e}function removePeepFromCrowd(e){removeItemFromArray(crowd,e),availablePeeps.push(e)}function render(){peoplecanvasEl&&(peoplecanvasEl.width=peoplecanvasEl.width,ctx.save(),ctx.scale(devicePixelRatio,devicePixelRatio),crowd.forEach(function(e){e.render(ctx)}),ctx.restore())}document.addEventListener("pjax:success",function(e){(peoplecanvasEl=document.getElementById("peoplecanvas"))&&(ctx=peoplecanvasEl?peoplecanvasEl.getContext("2d"):void 0,window.removeEventListener("resize",resize),gsap.ticker.remove(render),setTimeout(function(){peoplecanvasEl&&(resize(),gsap.ticker.add(render),window.addEventListener("resize",resize))},300))});